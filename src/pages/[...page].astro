---
import Layout from '../layouts/Layout.astro';
import FormattedDate from '../components/FormattedDate.astro';
import Pagination from '../components/Pagination.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths({paginate}) {
  const allPosts = await getCollection('posts');
  const sortedPosts = allPosts.sort((a, b) => new Date(b.data.pubDate) - new Date(a.data.pubDate));
  return paginate(sortedPosts, { pageSize: 20 });
}

export interface Props {
	page: any;
}

const { page } = Astro.props;

---

<Layout title="Emptygold" description="Bloggingâ€”it's a personal thing.">
	    <main>
	    	{page.data.map((post) => (
	    	      <div class="post">
	    	      	<Fragment set:html={post.rendered.html}/>
	    	      <a href=`/posts/${post.id}/`><FormattedDate date={post.data.pubDate} /></a>
	    	      <p class="tags">{(post.data.tags ? post.data.tags.flatMap((tag: string) => <span class="tag"><a href=`/tags/${tag}/`>#{tag}</a></span>) : "")}</p>
	    	      </div>
	    	    ))}
	    </main>

	    <Pagination page={page} />
	</Layout>